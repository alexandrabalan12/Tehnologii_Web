<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>My Account</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Yellowtail&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Jura:wght@400;700&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="./styles/index.css" />
		<link rel="stylesheet" href="./styles/pages/home.css" />
		<link rel="stylesheet" href="./styles/pages/afterlogin.css" />
		<link rel="stylesheet" href="./styles/pages/account.css" />
		<link
			rel="stylesheet"
			href="./styles/pages/myaccount-company-afteredit.css"
		/>

		<link rel="stylesheet" href="./styles/pages/aftersignup-company.css" />
		<script src="./scripts/utilites.js"></script>
		<script src="./scripts/navbar.js"></script>
	</head>
	<body>
		<div id="navbar-container"></div>

		<div>
			<h2 class="text-h2-title">My account</h2>
		</div>
		<div class="container">
			<div class="container-account">
				<div class="menu-account">
					<div class="text">
						<a
							href="company-account-details.html"
							class="text-body-copy-selected"
							>My Details</a
						>
						<a href="company-account-portfolio.html" class="text-body-copy"
							>Portfolio</a
						>
						<a href="./company-account-reviews.html" class="text-body-copy"
							>My Reviews</a
						>
					</div>
				</div>
				<div class="details-account">
					<div class="text">
						<div class="info-field">
							<label for="modify-company-name" class="text-body-copy-bold"
								>Company name:</label
							>
							<div class="modify-company-name">
								<div class="input-group__area">
									<input
										id="modify-company-name"
										name="modify-company-name"
										type="text"
									/>
								</div>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-number" class="text-body-copy-bold"
								>Phone number:</label
							>
							<div class="number-members">
								<div class="input-group__area">
									<input id="modify-number" name="number-members" type="text" />
								</div>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-description" class="text-body-copy-bold"
								>Short Description:</label
							>
							<div class="short-description">
								<div class="input-group__area">
									<textarea
										id="modify-description"
										name="number-members"
										placeholder="Your message..."
									></textarea>
								</div>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-company-address" class="text-body-copy-bold"
								>Adress:</label
							>
							<div class="modify-company-name">
								<div class="input-group__area">
									<input
										id="modify-company-address"
										name="modify-geographical-area"
										type="text"
									/>
								</div>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-company-location" class="text-body-copy-bold"
								>Location:</label
							>
							<div>
								<select
									class="select-standard"
									name="1A"
									id="modify-company-location"
								>
									<option value="brasov">Brasov</option>
									<option value="bucuresti">Bucuresti</option>
									<option value="cluj">Cluj</option>
									<option value="iasi">Iasi</option>
									<option value="timisoara">Timisoara</option>
								</select>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-proffesional-area" class="text-body-copy-bold"
								>Professional Area:</label
							>
							<div>
								<select
									class="select-standard"
									name="1A"
									id="modify-proffesional-area"
								>
									<option value="interior_design">Interior design</option>
									<option value="masonry">Masonry</option>
									<option value="plumbing">Plumbing</option>
									<option value="roofing">Roofing</option>
									<option value="structural_engineering">
										Structural engineering
									</option>
								</select>
							</div>
						</div>
						<div class="info-field">
							<label for="modify-general-contractor" class="text-body-copy-bold"
								>General Contractor:</label
							>
							<div class="modify-company-name">
								<div class="input-group__area">
									<input
										id="modify-general-contractor"
										name="modify-general-contractor"
										type="text"
									/>
								</div>
							</div>
						</div>

						<div class="info-field">
							<h4 class="text-body-copy-bold">Open To Travel For Projects:</h4>
							<input
								id="travel-projects-yes"
								name="travel-projects"
								type="radio"
								value="yes"
							/>
							<label for="travel-projects-yes" class="radio-label">Yes</label>
							<input
								id="travel-projects-no"
								name="travel-projects"
								type="radio"
								value="no"
							/>
							<label for="travel-projects-no" class="radio-label">No</label>
						</div>
					</div>
				</div>
			</div>

			<div class="save-changes">
				<button id="save-changes" class="button-primary">SAVE CHANGES</button>
			</div>
		</div>
		<div class="container">
			<h2 class="text-h2">Contact us</h2>
			<div class="contact-info">
				<div class="contact-mail">
					<img src="./assets/email.png" alt="Email icon" />
					<p class="text-body-copy">emailemail@gmail.com</p>
				</div>
				<div class="contact-phone">
					<img src="./assets/phone.png" alt="Phone icon" />
					<p class="text-body-copy">+407.12.123.123</p>
				</div>
				<div class="contact-adress">
					<img src="./assets/location.png" alt="Location icon" />
					<p class="text-body-copy">Iasi, Romania</p>
				</div>
			</div>
		</div>
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				let company_details = {};

				const company_name_input = document.getElementById(
					"modify-company-name"
				);
				const company_number_input = document.getElementById("modify-number");
				const company_description_input =
					document.getElementById("modify-description");
				const company_location_input = document.getElementById(
					"modify-company-location"
				);
				const company_adress_input = document.getElementById(
					"modify-company-address"
				);
				const company_proffesionalarea_input = document.getElementById(
					"modify-proffesional-area"
				);
				const company_contractor_input = document.getElementById(
					"modify-general-contractor"
				);
				const travel_yes_radio = document.getElementById("travel-projects-yes");
				const travel_no_radio = document.getElementById("travel-projects-no");
				const button = document.getElementById("save-changes");

				function initialData() {
					company_name_input.value = company_details.company_name;
					company_number_input.value = company_details.phone_number;
					company_description_input.value = company_details.description;
					company_location_input.value = company_details.location;
					company_adress_input.value = company_details.address;
					company_proffesionalarea_input.value = company_details.professional_area;
					company_contractor_input.value = company_details.owner_name;

					if (company_details.open_to_travel === "yes") {
						travel_yes_radio.checked = true;
					} else {
						travel_no_radio.checked = true;
					}
				}

				const token = localStorage.getItem("authToken");
				const userData = JSON.parse(localStorage.getItem("userData"));

				async function fetchCompanyData() {
					try {
						const companyId = userData.company_id;

						const response = await apiRequest(
							`http://localhost:8000/api/company/company-details/${companyId}`,
							"GET",
							null,
							{
								authorization: token,
								"user-type": "company",
							}
						);

						company_details = response.data;
						console.log(response);

						initialData();
					} catch (err) {
						console.log(err);
						alert("Error, please try again later");
					}
				}

				function createPayload() {
					const payload = {
						user_id: userData.id,
						company_name: company_name_input.value,
						phone_number: company_number_input.value,
						description: company_description_input.value,
						location: company_location_input.value,
						address: company_adress_input.value,
						professional_area: company_proffesionalarea_input.value,
						owner_name: company_contractor_input.value,
						open_to_travel: travel_yes_radio.checked ? true : false,
					};

					return payload;
				}

				async function setCompanyDetails() {
					const payload = createPayload();
					const companyId = userData.company_id;

					try {
						const data = await apiRequest(
							`http://localhost:8000/api/company/company-details/${companyId}`,
							"PUT",
							payload,
							{
								authorization: token,
								"user-type": "company",
							}
						);

						window.location.href =
							"http://127.0.0.1:5500/company-account-details.html";
					} catch (err) {
						console.log(err);
						alert("An error has occured");
					}
				}

				button.addEventListener("click", () => setCompanyDetails());

				fetchCompanyData();
			});
		</script>
	</body>
</html>
